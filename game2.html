<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ë–ª–∏–Ω–Ω–∞—è –ë–∞—à–Ω—è</title>
    <style>
        html, body {
            width: 100%; height: 100%; margin: 0; padding: 0;
            overflow: hidden; touch-action: none; /* –ó–∞–ø—Ä–µ—Ç –∑—É–º–∞ –∏ —Å–∫—Ä–æ–ª–ª–∞ */
            font-family: 'Arial Rounded MT Bold', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        }
        
        /* –°–ª–æ–π –∏–≥—Ä—ã */
        #game-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 1;
        }
        
        /* –°–ª–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ (–ø–æ–≤–µ—Ä—Ö –∏–≥—Ä—ã) */
        #ui-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 10; pointer-events: none; /* –ß—Ç–æ–±—ã –ø—Ä–æ–ø—É—Å–∫–∞—Ç—å –∫–ª–∏–∫–∏ –≤ –∏–≥—Ä—É, –∫–æ–≥–¥–∞ –º–µ–Ω—é —Å–∫—Ä—ã—Ç–æ */
            display: flex; flex-direction: column; justify-content: center; align-items: center;
        }

        /* –°—á–µ—Ç */
        #score-board {
            position: absolute; top: 10%; 
            font-size: 4rem; color: rgba(255, 107, 107, 0.5); font-weight: bold;
            pointer-events: none; user-select: none;
            text-shadow: 2px 2px 0 #fff;
            transition: transform 0.1s;
        }

        /* –ú–µ–Ω—é (–º–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞) */
        .screen {
            pointer-events: auto; /* –í–∫–ª—é—á–∞–µ–º –∫–ª–∏–∫–∏ –¥–ª—è –º–µ–Ω—é */
            background: rgba(255, 255, 255, 0.95);
            padding: 30px; border-radius: 25px;
            text-align: center; box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            width: 80%; max-width: 350px;
            display: flex; flex-direction: column; gap: 20px;
            animation: popIn 0.3s ease-out;
        }

        @keyframes popIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }

        h1 { margin: 0; color: #ff6b6b; font-size: 24px; }
        p { margin: 0; color: #666; font-size: 16px; }
        
        .btn {
            background: #ff6b6b; color: white; border: none; padding: 15px;
            font-size: 20px; border-radius: 12px; font-weight: bold;
            cursor: pointer; touch-action: manipulation;
            box-shadow: 0 5px 0 #e05656;
            transition: transform 0.1s, box-shadow 0.1s;
        }
        .btn:active { transform: translateY(5px); box-shadow: none; }

        .hidden { display: none !important; }
    </style>
</head>
<body>

    <canvas id="game-layer"></canvas>

    <div id="ui-layer">
        <div id="score-board" class="hidden">0</div>

        <div id="start-screen" class="screen">
            <h1>ü•û –ë–ª–∏–Ω–Ω–∞—è –ë–∞—à–Ω—è</h1>
            <p>–°—Ç—Ä–æ–π –≤—ã—à–µ!<br>–ö–æ—Å–Ω–∏—Å—å —ç–∫—Ä–∞–Ω–∞, —á—Ç–æ–±—ã –ø–æ–ª–æ–∂–∏—Ç—å –±–ª–∏–Ω.</p>
            <button class="btn" id="start-btn">–ü–û–ï–•–ê–õ–ò!</button>
        </div>

        <div id="game-over-screen" class="screen hidden">
            <h1>–£–ø–∞–ª–æ! üò±</h1>
            <p>–¢–≤–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:</p>
            <div style="font-size: 48px; color: #333;" id="final-score">0</div>
            <button class="btn" id="restart-btn">–ï–©–Å –†–ê–ó</button>
        </div>
    </div>

<script>
    // --- –ù–ê–°–¢–†–û–ô–ö–ò ---
    const CONFIG = {
        h: 35, // –í—ã—Å–æ—Ç–∞ –±–ª–∏–Ω–∞
        speed: 4, // –°–∫–æ—Ä–æ—Å—Ç—å
        colors: ["#FFB7B2", "#FFDAC1", "#E2F0CB", "#B5EAD7", "#C7CEEA", "#ff9ff3"]
    };

    // --- –°–û–°–¢–û–Ø–ù–ò–ï ---
    let canvas, ctx;
    let w, h;
    let state = {
        phase: 'menu', // menu, playing, gameover
        score: 0,
        stack: [], // {x, y, w, color}
        current: null, // {x, y, w, dir, pos}
        cameraY: 0,
        debris: []
    };

    // --- –ê–£–î–ò–û (–ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ) ---
    let audioCtx;
    function tryInitAudio() {
        try {
            const AudioContext = window.AudioContext || window.webkitAudioContext;
            if (AudioContext) {
                audioCtx = new AudioContext();
                // –ü—É—Å—Ç–æ–π –∑–≤—É–∫ –¥–ª—è "–ø—Ä–æ–≥—Ä–µ–≤–∞" iOS
                const osc = audioCtx.createOscillator();
                osc.connect(audioCtx.destination);
                osc.start(); osc.stop(0.01);
            }
        } catch (e) { console.warn("Audio disabled"); }
    }

    function beep(freq) {
        if (!audioCtx) return;
        try {
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.frequency.value = freq;
            osc.type = 'sine';
            gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
            osc.connect(gain); gain.connect(audioCtx.destination);
            osc.start(); osc.stop(audioCtx.currentTime + 0.15);
        } catch(e) {}
    }

    // --- –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ---
    window.onload = () => {
        canvas = document.getElementById('game-layer');
        ctx = canvas.getContext('2d');
        resize();
        window.addEventListener('resize', resize);
        
        // –ü—Ä–∏–≤—è–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏
        document.getElementById('start-btn').addEventListener('pointerup', startGame);
        document.getElementById('restart-btn').addEventListener('pointerup', startGame);
        
        // –ü—Ä–∏–≤—è–∑—ã–≤–∞–µ–º –∫–ª–∏–∫ –ø–æ —ç–∫—Ä–∞–Ω—É (—Å–∞–º–∞ –∏–≥—Ä–∞)
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º pointerdown –¥–ª—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–π —Ä–µ–∞–∫—Ü–∏–∏
        document.addEventListener('pointerdown', handleGameInput);

        loop(); // –ó–∞–ø—É—Å–∫–∞–µ–º —Ü–∏–∫–ª –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ —Å—Ä–∞–∑—É
    };

    function resize() {
        w = window.innerWidth;
        h = window.innerHeight;
        canvas.width = w;
        canvas.height = h;
    }

    // --- –õ–û–ì–ò–ö–ê –ò–ì–†–´ ---
    function startGame(e) {
        // –í–∞–∂–Ω–æ: –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–ø–ª—ã—Ç–∏–µ —Å–æ–±—ã—Ç–∏—è, —á—Ç–æ–±—ã –æ–Ω–æ –Ω–µ —Å—á–∏—Ç–∞–ª–æ—Å—å –∫–ª–∏–∫–æ–º –ø–æ –∏–≥—Ä–µ
        if(e) e.stopPropagation();
        
        tryInitAudio();

        // –°–±—Ä–æ—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è
        state.score = 0;
        state.debris = [];
        state.stack = [];
        state.cameraY = 0;
        
        // –ë–∞–∑–æ–≤—ã–π –±–ª–∏–Ω
        state.stack.push({
            x: w/2, y: h - 100, w: 200, c: CONFIG.colors[0]
        });

        spawnPancake();
        
        // UI
        state.phase = 'playing';
        document.getElementById('start-screen').classList.add('hidden');
        document.getElementById('game-over-screen').classList.add('hidden');
        document.getElementById('score-board').classList.remove('hidden');
        updateScore(0);
    }

    function spawnPancake() {
        const top = state.stack[state.stack.length - 1];
        state.current = {
            y: top.y - CONFIG.h,
            w: top.w,
            x: 0, // –°—Ç–∞—Ä—Ç—É–µ–º —Å –∫—Ä–∞—è
            dir: 1, // 1 –≤–ø—Ä–∞–≤–æ, -1 –≤–ª–µ–≤–æ
            pos: -200, // –§–∞–∫—Ç–∏—á–µ—Å–∫–∞—è –ø–æ–∑–∏—Ü–∏—è –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏
            c: CONFIG.colors[state.score % CONFIG.colors.length]
        };
    }

    function handleGameInput(e) {
        // –ï—Å–ª–∏ –Ω–µ –∏–≥—Ä–∞–µ–º, –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º –Ω–∞–∂–∞—Ç–∏—è
        if (state.phase !== 'playing') return;
        
        // –ë–ª–æ–∫–∏—Ä—É–µ–º –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –Ω–∞–∂–∞—Ç–∏—è –∑–∞ –∫–∞–¥—Ä
        if (!state.current) return;

        placePancake();
    }

    function placePancake() {
        const curr = state.current;
        const prev = state.stack[state.stack.length - 1];
        
        // –¶–µ–Ω—Ç—Ä —ç–∫—Ä–∞–Ω–∞ = w/2.
        // curr.pos - —ç—Ç–æ —Å–º–µ—â–µ–Ω–∏–µ –æ—Ç —Ü–µ–Ω—Ç—Ä–∞, –µ—Å–ª–∏ –º—ã —Å—á–∏—Ç–∞–µ–º –ª–æ–≥–∏–∫—É —Ç–∞–∫.
        // –ù–æ –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã: curr.x –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –≤ update().
        
        const dist = curr.x - prev.x;
        const absDist = Math.abs(dist);
        
        if (absDist > prev.w) {
            return gameOver();
        }

        // –£—Å–ø–µ—Ö
        const newW = prev.w - absDist;
        const newX = prev.x + (dist / 2);
        
        state.stack.push({
            x: newX,
            y: curr.y,
            w: newW,
            c: curr.c
        });

        // –û–±–ª–æ–º–æ–∫
        state.debris.push({
            x: dist > 0 ? newX + newW/2 + absDist/2 : newX - newW/2 - absDist/2,
            y: curr.y,
            w: absDist,
            h: CONFIG.h,
            c: curr.c,
            vy: 0, rot: 0
        });

        state.score++;
        updateScore(state.score);
        beep(300 + (state.score * 20));
        
        spawnPancake();
    }

    function gameOver() {
        state.phase = 'gameover';
        beep(100);
        
        // –ü–∞–¥–∞—é—â–∏–π —Ç–µ–∫—É—â–∏–π –±–ª–∏–Ω
        state.debris.push({
            x: state.current.x, y: state.current.y,
            w: state.current.w, h: CONFIG.h, c: state.current.c,
            vy: 0, rot: 0
        });
        state.current = null;

        setTimeout(() => {
            document.getElementById('final-score').innerText = state.score;
            document.getElementById('game-over-screen').classList.remove('hidden');
            document.getElementById('score-board').classList.add('hidden');
        }, 800);
    }

    function updateScore(s) {
        const el = document.getElementById('score-board');
        el.innerText = s;
        el.style.transform = "scale(1.3)";
        setTimeout(() => el.style.transform = "scale(1)", 100);
    }

    // --- –û–¢–†–ò–°–û–í–ö–ê ---
    function loop() {
        // –û—á–∏—Å—Ç–∫–∞
        ctx.fillStyle = "#f5f7fa"; // –§–æ–Ω, –µ—Å–ª–∏ –≥—Ä–∞–¥–∏–µ–Ω—Ç CSS –Ω–µ –≤–∏–¥–µ–Ω
        ctx.clearRect(0,0,w,h);

        // –î–≤–∏–∂–µ–Ω–∏–µ –∫–∞–º–µ—Ä—ã
        let targetCam = (state.score * CONFIG.h) - 100;
        if (targetCam < 0) targetCam = 0;
        state.cameraY += (targetCam - state.cameraY) * 0.1;

        ctx.save();
        ctx.translate(0, state.cameraY);

        // –†–∏—Å—É–µ–º —Å—Ç–µ–∫
        state.stack.forEach(p => drawRect(p.x, p.y, p.w, CONFIG.h, p.c));

        // –†–∏—Å—É–µ–º –æ–±–ª–æ–º–∫–∏
        state.debris.forEach(d => {
            d.vy += 0.5; d.y += d.vy; d.rot += 0.1;
            ctx.save();
            ctx.translate(d.x, d.y);
            ctx.rotate(d.rot);
            drawRect(0, 0, d.w, d.h, d.c);
            ctx.restore();
        });

        // –†–∏—Å—É–µ–º —Ç–µ–∫—É—â–∏–π
        if (state.phase === 'playing' && state.current) {
            // –õ–æ–≥–∏–∫–∞ –¥–≤–∏–∂–µ–Ω–∏—è
            const speed = CONFIG.speed + (state.score * 0.1);
            state.current.pos += speed * state.current.dir;
            
            // –ì—Ä–∞–Ω–∏—Ü—ã –¥–≤–∏–∂–µ–Ω–∏—è (–∞–º–ø–ª–∏—Ç—É–¥–∞)
            if (state.current.pos > 300) state.current.dir = -1;
            if (state.current.pos < -300) state.current.dir = 1;
            
            state.current.x = (w/2) + state.current.pos;
            
            drawRect(state.current.x, state.current.y, state.current.w, CONFIG.h, state.current.c);
        }

        ctx.restore();
        requestAnimationFrame(loop);
    }

    function drawRect(x, y, width, height, color) {
        ctx.fillStyle = color;
        // –¢–µ–Ω—å
        ctx.fillRect(x - width/2, y - height/2 + 5, width, height);
        // –û—Å–Ω–æ–≤–∞
        ctx.fillStyle = adjustColor(color, 20);
        ctx.fillRect(x - width/2, y - height/2, width, height - 5);
        // –û–±–≤–æ–¥–∫–∞
        ctx.strokeStyle = "rgba(0,0,0,0.1)";
        ctx.lineWidth = 2;
        ctx.strokeRect(x - width/2, y - height/2, width, height - 5);
    }

    // –£—Ç–∏–ª–∏—Ç–∞ –¥–ª—è –æ—Å–≤–µ—Ç–ª–µ–Ω–∏—è —Ü–≤–µ—Ç–∞
    function adjustColor(color, amount) {
        return color; // –£–ø—Ä–æ—â–µ–Ω–æ –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
    }

</script>
</body>
</html>
